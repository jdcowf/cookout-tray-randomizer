<!DOCTYPE html>
<html>
    <head>
        <title>Cookout Tray Randomizer</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"/>
		<link rel="stylesheet" href="static/css/app.css" media="screen">
    </head>
	
	
	<nav class="dt bg-black white w-100 border-box pa3 ph5-ns">
	    <div class="dtc v-mid w-25 tl">
	        <i class="fa fa-sliders fa-3x white"></i>
	    </div>
        <div class="dtc v-mid w-75 tr">
            <a class="link dim white f6 f5-ns dib" onClick="randomizeSelection()" title="Randomize"><span class="fa fa-refresh fa-3x"></span></a>
        </div>
    </nav>
	
	<body width=100vw class="bg-red white">
		<p id="tray" class="tray tc f1 yellow">tray</p>
		<p id="side1" class="side tc f2 yellow">side1</p>
		<p id="side2" class="side tc f2 yellow">side2</p>
	</body>

    <button onclick="saveSelection(getSelection())">Save Selection</button>
    <button onclick="alert(getSavedSelection())">Get Last Selection</button>
	
	<footer class="dt bg-black white w-100 border-box pa3 ph5-ns">
        <a class="white fa fa-github fa-2x" href="https://github.com/jdcowf/cookout-tray-randomizer"></a>
	</footer>
<html>

<script>
window.addEventListener('load', randomizeSelection())


function randomElementFromArray(a) {
    return a[Math.floor(Math.random() * a.length)]
}


function randomizeSelection() {
    fetch('static/data/trays.json')
    .then(function (response) {
        return response.json();
    })
    .then(function (data) {
        updateSelection(data);
    })
    .catch(function (err) {
        console.log('error: ' + err);
    });
}


function updateSelection(data) {
    document.querySelector("#tray").innerHTML = randomElementFromArray(data.trays);
    document.querySelector("#side1").innerHTML = randomElementFromArray(data.sides);
    document.querySelector("#side2").innerHTML = randomElementFromArray(data.sides);
}


function getSelection() {
    return {
        "tray": document.querySelector("#tray").innerHTML,
        "sides": [
                document.querySelector("#side1").innerHTML,
                document.querySelector("#side2").innerHTML
        ]
    }
}


function encodeTray(tray) {
    // todo - convert tray to an integer value
     // 4bits per selection
    return ["123", "127", "199"][Math.floor(Math.random() * 3)]
}


function decodeTray(code) {
    // todo - deconvert tray to an integer value
     // 4bits per selection
}


function getSavedSelection() {
    return window.localStorage.getItem("Selections")[-1]
}


function saveSelection(selection) {
    var previousSelections = window.localStorage.getItem("Selections")
    if (!previousSelections) {
        previousSelections = []
    }
    // previousSelections.push(selection)
    var badge = getBadge(encodeTray(selection))
    if (badge) {
        alert(badge)
    }
    console.log("Saving selection: ", JSON.stringify(selection))
    window.localStorage.setItem("Selections", JSON.stringify(selection))

}

function getBadge(selection) {
    var d = {
        "123": "Earned Quesadilla Tray badge",
        "127": "Earned Weenie Tray badge",
        "199": "Earned The Daily Double Tray badge",
    }
    console.log(selection, d[selection])
    return d[selection]
}

</script>